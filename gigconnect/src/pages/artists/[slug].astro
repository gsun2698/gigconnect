---
import artists from "../../data/artists.json"
import BaseLayout from "../../layouts/BaseLayout.astro";

// Generate a static page for each artist based on slug
export function getStaticPaths() {
  return artists.map((a) => ({
    params: { slug: a.slug },
  }));
}

const { slug } = Astro.params;

// Find the artist by slug
const artist = artists.find((a) => a.slug === slug);
if (!artist) {
  throw new Error(`Artist not found for slug: ${slug}`);
}
---

<BaseLayout title={`GigConnect - ${artist.name}`}>

  <!-- Top nav -->
  <section class="mb-6 flex items-center justify-between gap-4">
    <a href="/artists" class="text-lg text-slate-300 hover:text-indigo-400 transition-colors">
      &larr; Back to Artists
    </a>
  </section>

  <!-- Artist Header -->
  <section class="relative w-full h-96 sm:h-[28rem] rounded-3xl overflow-hidden shadow-lg">
    {artist.image && (
      <img src={artist.image} alt={artist.name} class="absolute inset-0 w-full h-full object-contain brightness-75"/>
    )}
    <div class="absolute inset-0 bg-gradient-to-t from-slate-800/90 to-transparent"></div>

    <!-- Name & Genre overlay -->
    <div class="absolute bottom-6 left-6 text-white">
      <h1 class="text-4xl sm:text-5xl font-extrabold drop-shadow-lg">{artist.name}</h1>
      <p class="mt-1 text-sm sm:text-base text-slate-200 drop-shadow">{artist.genre} Â· {artist.location}</p>
    </div>
  </section>

  <!-- Artist Details Grid -->
  <section class="mt-10 max-w-6xl mx-auto grid grid-cols-1 lg:grid-cols-2 gap-8">

    <!-- Description + Social -->
    <div class="bg-slate-800/80 backdrop-blur-md rounded-2xl p-8 shadow-lg space-y-6">
      <p class="text-slate-300 text-lg leading-relaxed">
        {artist.description}
      </p>

      <div class="flex flex-wrap gap-4 items-center">
        <a href="#"
           title="Website not available for demo"
           class="px-4 py-2 bg-indigo-600 hover:bg-indigo-500 text-white rounded-lg text-sm font-medium cursor-not-allowed">
          ğŸŒ Website
        </a>
        <a href="#"
           title="Instagram link not available for demo"
           class="px-4 py-2 bg-pink-500 hover:bg-pink-400 text-white rounded-lg text-sm font-medium cursor-not-allowed">
          ğŸ“¸ Instagram
        </a>
        <a href="#"
           title="Spotify link not available for demo"
           class="px-4 py-2 bg-green-600 hover:bg-green-500 text-white rounded-lg text-sm font-medium cursor-not-allowed">
          ğŸµ Spotify
        </a>
      </div>
    </div>

    <!-- Tour Dates -->
    <div class="bg-slate-800/80 backdrop-blur-md rounded-2xl p-8 shadow-lg space-y-4">
      <h2 class="text-2xl font-bold text-white">Upcoming Tour Dates</h2>

      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
        <div class="bg-slate-700/60 p-4 rounded-lg">
          <p class="font-semibold text-white">Dec 20, 2025</p>
          <p class="text-slate-300 text-sm">The Neon Arena Â· Los Angeles, CA</p>
        </div>
        <div class="bg-slate-700/60 p-4 rounded-lg">
          <p class="font-semibold text-white">Jan 5, 2026</p>
          <p class="text-slate-300 text-sm">Pulse Hall Â· New York, NY</p>
        </div>
        <div class="bg-slate-700/60 p-4 rounded-lg">
          <p class="font-semibold text-white">Feb 10, 2026</p>
          <p class="text-slate-300 text-sm">Lunar Stage Â· Chicago, IL</p>
        </div>
        <div class="bg-slate-700/60 p-4 rounded-lg">
          <p class="font-semibold text-white">Mar 2, 2026</p>
          <p class="text-slate-300 text-sm">Nova Prime Â· Miami, FL</p>
        </div>
      </div>
    </div>

    <!-- Management -->
    <div class="bg-slate-800/80 backdrop-blur-md rounded-2xl p-8 shadow-lg space-y-6">
      <h2 class="text-2xl font-bold text-white">Management & Booking</h2>

      <div class="grid sm:grid-cols-2 gap-6">
        <div>
          <p class="text-sm text-slate-400">Manager</p>
          <p class="text-lg font-semibold text-white">Alex Rivera</p>
        </div>
        <div>
          <p class="text-sm text-slate-400">Booking Email</p>
          <p class="text-lg font-semibold text-white">booking@gigconnect.com</p>
        </div>
        <div>
          <p class="text-sm text-slate-400">Phone</p>
          <p class="text-lg font-semibold text-white">(555) 123-9876</p>
        </div>
        <div>
          <p class="text-sm text-slate-400">Preferred Regions</p>
          <p class="text-lg font-semibold text-white">US Â· Canada Â· Europe</p>
        </div>
      </div>

      <p class="text-xs text-slate-400">
        *Contact information is for demo purposes only.
      </p>
    </div>

    <!-- Reviews -->
    <div class="bg-slate-800/80 backdrop-blur-md rounded-2xl p-8 shadow-lg space-y-6">
      <h2 class="text-2xl font-bold text-white">What Bookers Are Saying</h2>

      <div class="space-y-4">
        <div class="bg-slate-700/60 p-5 rounded-xl">
          <div class="text-yellow-400 text-sm mb-1">â˜…â˜…â˜…â˜…â˜…</div>
          <p class="text-slate-200">
            â€œOne of the most professional and crowd-engaging artists we've booked.â€
          </p>
          <p class="mt-3 text-sm text-slate-400">
            â€” Jordan Miles Â· Miami
          </p>
        </div>

        <div class="bg-slate-700/60 p-5 rounded-xl">
          <div class="text-yellow-400 text-sm mb-1">â˜…â˜…â˜…â˜…â˜†</div>
          <p class="text-slate-200">
            â€œGreat energy, punctual, and easy to work with.â€
          </p>
          <p class="mt-3 text-sm text-slate-400">
            â€” Samantha Lee Â· Los Angeles
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- Planner Actions -->
  <section class="mt-10 justify-center max-w-4xl mx-auto flex flex-wrap gap-6">
    <button 
      id="add-to-planner" 
      data-slug={artist.slug} 
      class="bg-indigo-600 hover:bg-indigo-500 cursor-pointer text-white px-20 py-6 rounded-lg font-semibold text-lg transition-colors shadow-lg hover:scale-105 transform"
      title="Add this artist to your planner"
    >
      Add to Planner
    </button>

    <button 
      id="remove-from-planner" 
      data-slug={artist.slug} 
      class="bg-slate-700 hover:bg-slate-600 text-white px-20 py-6 rounded-lg font-semibold text-lg transition-colors shadow-lg hover:scale-105 transform"
      title="Remove this artist from your planner"
    >
      Remove
    </button>

    <button
      id="book-artist"
      class="bg-indigo-800 hover:bg-indigo-600 text-white px-20 py-6 rounded-lg font-semibold text-lg transition-colors shadow-lg hover:scale-105 transform cursor-not-allowed"
      title="Booking not available in demo"
    >
      Book Artist
    </button>
  </section>

  <!-- Client Script for Planner -->
  <script type="module" client:load>
    const STORAGE_KEY = "gigconnect-shortlist";
    const STAGE_KEY = "gigconnect-stage-assignments";
    const addBtn = document.getElementById("add-to-planner");
    const removeBtn = document.getElementById("remove-from-planner");
    const slug = addBtn?.dataset.slug || removeBtn?.dataset.slug || "";

    function getShortlist() {
      try { const raw = localStorage.getItem(STORAGE_KEY); return raw ? JSON.parse(raw) : []; } catch { return []; }
    }

    function saveShortlist(slugs) { localStorage.setItem(STORAGE_KEY, JSON.stringify(slugs)); }

    function getAssignments() {
      try { const raw = localStorage.getItem(STAGE_KEY); return raw ? JSON.parse(raw) : {}; } catch { return {}; }
    }

    function updateButtons() {
      const shortlist = getShortlist();
      const assignments = getAssignments();
      const inPlanner = shortlist.includes(slug);
      const assignedToStage = assignments[slug] !== undefined;

      if (addBtn) {
        addBtn.style.display = inPlanner ? "none" : "inline-flex";
        addBtn.disabled = assignedToStage;
      }

      if (removeBtn) {
        removeBtn.style.display = inPlanner ? "inline-flex" : "none";
        removeBtn.disabled = assignedToStage;
      }
    }

    updateButtons();

    addBtn?.addEventListener("click", () => {
      const shortlist = getShortlist();
      if (!shortlist.includes(slug)) {
        shortlist.push(slug);
        saveShortlist(shortlist);
        updateButtons();
      }
    });

    removeBtn?.addEventListener("click", () => {
      const assignments = getAssignments();
      if (assignments[slug]) return;
      const shortlist = getShortlist().filter(s => s !== slug);
      saveShortlist(shortlist);
      updateButtons();
    });
  </script>

</BaseLayout>
